[TOC]



# HCIA 网络工程技术

+ AR——企业网用
+ S企业网用——二层、三层交换机
+ CE——数据中心 核心 堆叠 集群 虚拟化
+ NE——核心路由器 
+ MEE——广电、传媒

# 网络拓扑

![image-20221011195453049](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221011195453049.png)



# 以太网接电口有三种工作模式

+ 全双工：端口同时发送和接收数据包（类似打电话）
+ 半双工：端口同一时刻只能发送数据包或接收数据包（类似于对讲机）
+ 自协商：端口双工状态由本端口和对端端口自动协商而定

以太网光接口只能工作在全双工模式下

# 网络通信协议

![image-20221012145404958](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145404958.png)







## OSI

![image-20221012145443241](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145443241.png)

![image-20221012145457765](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145457765.png)

### 七层

+ 物理层
  + 在设备之间传输比特流，规定了电平、速度和电缆针脚
  + 看得见摸得着的网络设备：网线、光纤、猫HUB
  
  
  
  
  
+ 数据链路层
  + 将比特组合成字节，再将字节组合成帧，使用链路层地址（以太网使用MAC地址）来访问介质，并进行差错检测
  + 交换机、MAC地址、
  
  
  
+ 网络层
  + 提供逻辑地址，供路由器确定路径
  
  
  
+ 传输层
  + 提供面向连接或非面向连接的数据传递以及进行重传前的差错检测
  
  
  
+ 会话层
  + 负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同的设备中的应用程序之间的服务请求和响应组成
  
    
  
+ 表示层
  + 提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别
  
    
  
+ 应用层
  + OSI参考模型中最靠近用户的一层，为应用程序提供网络服务
  
  

网络工程师：物理层、数据链路层、网络层、传输层

程序员：会话层、表示层、应用层



## TCP/IP协议

![image-20221012145512658](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145512658.png)

![image-20221012145523312](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145523312.png)

+ 物理层

  ![image-20221012150223210](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150223210.png)

+ 数据链路层

  ![image-20221012150032941](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150032941.png)

  ![image-20221012150046245](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150046245.png)

  ![image-20221012150058646](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150058646.png)

  ![image-20221012150118215](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150118215.png)

  ![image-20221012150132359](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150132359.png)

  ![image-20221012150143585](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150143585.png)

  ![image-20221012150154162](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150154162.png)

  

+ 网络层

  ![image-20221012145958036](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145958036.png)

  ![image-20221012150011658](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150011658.png)

  

+ 传输层

  ![image-20221012145723896](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145723896.png)

  ![image-20221012145739655](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145739655.png)

  ![image-20221012145748962](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145748962.png)

  ![image-20221012145757087](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145757087.png)

  ![image-20221012145806707](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145806707.png)

  ![image-20221012145817581](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145817581.png)

  ![image-20221012145835633](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145835633.png)

  ![image-20221012145849641](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145849641.png)

  ![image-20221012145859888](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145859888.png)

  ![image-20221012145914600](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145914600.png)

  ![image-20221012145927667](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145927667.png)

  ![image-20221012145937980](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145937980.png)

  

+ 应用层

  ![image-20221012145631226](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145631226.png)

  ![image-20221012145645254](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145645254.png)

  ![image-20221012145654460](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145654460.png)

  ![image-20221012145704268](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145704268.png)



以太网的MAC地址由两部分组成，分别是供应商代码和序列号。其中前24为代表供应商代码，由IEEE管理和分配，剩下24位序列号由厂商自己分配

![image-20220925190648464](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220925190648464.png)

![image-20221012145600143](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145600143.png)

## IP编址

网络层位于数据链路层与传输层之间。网络层中包含许多协议，其中最为重要的协议就是IP协议。网络层提供了IP路由功能。理解IP路由除了要熟悉IP协议的工作机制之外，还必须理解IP编址以及如何合理地使用IP地址来设计网络。

![image-20221012151235238](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151235238.png)

![image-20221012151244732](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151244732.png)

![image-20221012151255214](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151255214.png)

![image-20221012151302425](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151302425.png)

![image-20221012151314212](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151314212.png)

![image-20221012151326858](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151326858.png)

![image-20221012151333936](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151333936.png)

![image-20221012151343546](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151343546.png)

![image-20221012151352521](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151352521.png)

![image-20221012151358472](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151358472.png)

![image-20221012151406095](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151406095.png)

![image-20221012151414384](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151414384.png)

![image-20221012151422738](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151422738.png)

![image-20221012151429412](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151429412.png)

![image-20221012151437417](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151437417.png)

![image-20221012151443816](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151443816.png)

![image-20221012151451537](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151451537.png)

![image-20221012151458907](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151458907.png)

![image-20221012151505607](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151505607.png)

![image-20221012151513040](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151513040.png)

![image-20221012151523592](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012151523592.png)



## ARP协议

+ 当网络设备有数据要发送给另一台网络设备时，必需要知道对方的网络层地址（即IP地址）
+ IP地址由网络层来提供，但是仅有IP地址是不够的，IP数据报文必须封装称帧才能通过数据链路进行发送。
+ 数据帧必须包含目的MAC地址，因此发送端还必须获取到目的MAC地址。
+ 通过目的IP地址来获取目的MAC地址的过程是由ARP（Address Resolution Protocol）协议来实现

![image-20221012152405503](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152405503.png)

![image-20221012152418852](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152418852.png)

![image-20221012152428655](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152428655.png)

![image-20221012152437203](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152437203.png)

![image-20221012152447601](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152447601.png)

![image-20221012152455230](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152455230.png)

![image-20221012152505575](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152505575.png)

![image-20221012152513735](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152513735.png)

![image-20221012152520906](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152520906.png)

![image-20221012152529823](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152529823.png)

![image-20221012152537499](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012152537499.png)



## 数据通信过程

![image-20221012150333215](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150333215.png)

![image-20221012150341209](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150341209.png)

![image-20221012150348298](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012150348298.png)



# 网络设备管理基础

## VRP

+ 通用路由平台VRP（Versatile Routing P；atform）是华为公司数据通信产品的通用操作系统平台，它以IP业务为核心，采用组件化的体系节后，在实现丰富功能特性的同时，还提供了基于应用的可裁剪和可扩展的功能，使得路由器和交换机的运行效率大大增加。熟悉VRP操作系统并且熟练掌握VRP配置是高效管理华为网络设备的基础。
+ VRP是华为数据通信产品的通用操作系统平台，作为华为公司从低端到核心的全系列路由器、以太网交换局、业务网关等产品的软件核心引擎

### 功能

+ 实现统一的用户界面和管理界面
+ 实现控制平面功能，并定义转发平面接口规范
+ 实现各产品转发平面与VRP控制平面之间的交互
+ 屏蔽各产品链路层对于网络层的差异



## 设备初始化过程

+ 设备上电后，首先运行BootROM软件，初始化硬件并显示设备的硬件参数，然后运行系统软件，最后从默认存储路径中读取配置文件进行设备初始化的操作

  ![image-20221012113654248](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012113654248.png)

  

## 设备管理

+ 用户对设备常见管理方式主要有命令行方式和Web网关方式两种

  + Web网管方式
    + Web网管方式通过图形化的操作界面，实现对设备直观方便地管理与维护，但是此方式仅可实现对设备部分功能的管理与维护
    + Web网管方式可以通过HTTP和HTTPS方式登录设备
  + 命令行方式
    + 命令行方式需要用户使用设备提供的命令行对设备进行管理与维护，此方式可实现对黑色被的精细化管理，但是要求用户收悉命令行
    + 命令行方式可以通过Console口、Telent或SSH方式登录设备

+ 用户需要通过相应的方式登录到设备后才能对设备进行管理

  

## VRP用户界面

+ 用户通过命令行方式登录设备时，系统会分配一个用户界面来管理、监控设备和用户间的当前会话
+ 设备系统支持的用户界面有Console用户界面和虚拟类型终端VTY（Virtual Type Terminal）用户界面
  + Console用户界面
    + Console用户界面用来管理和监控通过Console口登录的用户
    + 用户终端的串行口可以与设备Console口直接连接，实现对设备的本地访问
  + VTY用户界面
    + VTY用户界面用来管理和监控通过VTY方式登录的用户
    + 用户通过终端与设备建立Telnet或STelnet连接后，即建立了一条VTY通道，通过VTY通道实现对设备的远程访问



## VRP用户级别

VRP提供级别的权限控制，可以实现不同级别的用户能够执行不同级别的命令，用以限制不同用户对设备的操作

![image-20221012143420548](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012143420548.png)



## 基本配置命令

![image-20221012145134969](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145134969.png)

![image-20221012145156209](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145156209.png)

![image-20221012145208462](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145208462.png)

![image-20221012145218935](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145218935.png)

![image-20221012145240844](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012145240844.png)





# 交换机

作用：为接入交换机的任意两个网络结点提供独享的电信号通路。

+ 以太网交换机

  + 目前最常见的一种，在校园、企业、运营商等网络中大量使用。

+ 电话语音交换机

  + 用于承载语音通信的交换机

  ![image-20221011200538966](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221011200538966.png)

+ 光纤交换机

  + 用于连接存储和服务器，是网络化存储中的一个组成单元（FC Switch，光纤通道交换机）

  ![image-20221011200550022](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221011200550022.png)

  

## 工作原理

+ 交换机接收端口与源数据地址的MAC建立一张二元组的MAC地址表

  <img src="HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/6NKvuihJqsOXVWZ.png" alt="Snipaste_2022-09-27_18-26-06.png" style="zoom:50%;" />

  + 交换机MAC地址表的维护：再次从同一接口接收到相同MAC地址为源MAC地址的数据帧，它就用新的时间来更新这个MAC地址条目

  + 在老化时间之内，没有通过这个接口再次接收到这个MAC地址发来的数据帧，它就会将这个老化的条目从自己的MAC地址表中删除

    + 查看MAC地址表老化时间

      ```
      display mac-address aging-time
      ```

    + 修改MAC地址表老化时间

      ```
      mac-address aging-time xx
      ```

  + 交换机MAC地址表的静态创建

    + 静态添加的MAC地址条目优先级高于交换机通过自己的接口动态学习到的条目

      + 静态添加静态MAC地址条目

        ```
        mac-address static xxxx-xxxx-xxxx g1/1 vlan 1
        ```

        

+ 目的MAC在主机的MAC地址表中，则从对应接口转发，否则向所有端口转发（flood）

+ 交换机接收到广播帧或组播帧则向所有端口转发





+ 交换机接收到一个单播数据帧时会查看其二层头部信息
  + 需要用数据的源MAC地址与其他相关信息来填充自己的MAC地址表
  + 为了查看数据帧的目的MAC地址，并且根据数据帧的目的MAC地址来查找自己的MAC地址表



+ 交换机查找MAC地址表结果对数据帧进行处理分三方面

  + 泛洪（Flooding）：交换机没有在自己的MAC地址表中找到这个数据帧的目的MAC地址

    ![image-20220927185418887](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927185418887.png)

    + PC1向PC3发送数据，PC1数据通过线路到达交换机，交换机的MAC地址表中已有PC1MAC地址，不需要再创建。但是交换机没有数据帧的目的地址（PC3），所以交换机向除PC1外的接口都转发一份

  + 转发（Forwarding）：交换机的MAC地址表中拥有这个数据帧的目的MAC地址，且其对应的接口并不接收到这个数据帧的接口

    <img src="HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927190140852.png" alt="image-20220927190140852" style="zoom: 67%;" />

  + 丢弃（Discarding）：交换机的MAC地址表中拥有这个数据帧的目的MAC地址，且其对应的接口正是接收到这个数据帧的接口

    <img src="HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927190115726.png" alt="image-20220927190115726" style="zoom: 67%;" />





## 交换机的工作特点的利弊

1. 交换机可以实现即插即用
2. 恶意用户可以利用交换机的工作原理发起网络攻击
3. 通信数据在局域网里没有私密性





# VLAN

## 虚拟局域网（VLAN）技术

+ 通过逻辑手段重新分配物理资源的虚拟化技术
+ 通过逻辑手段，将某些特定的设备组成一个广播域
+ 无需考虑这些设备连接的是否是同一台交换机



## VLAN用途

1. 解决随着广播域增大而来的性能和安全性降低的问题
2. 逻辑上把一个物理局域网分隔为多个广播域
3. 每个广播域称为一个虚拟的局域网



## 特点

1. 每台网络终端设备只能属于一个VLAN，但是一个VLAN可以有多个终端
2. 属于同一个VLAN的设备之间可以通过二层直接通信
3. 属于不同VLAN的设备之间只能通过IP路由功能才能够实现通信



## 原理

+ VLAN技术会通过数据帧插入不同的VLAN标签

+ 交换机通过VLAN标签分辨出各个数据帧所属的VLAN

  



![image-20220927204715015](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927204715015.png)



+ 没有携带VLAN标签（Tag）的数据帧

![image-20220927205123962](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927205123962.png)

+ 携带VLAN标签的数据帧

![image-20220927205228045](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927205228045.png)

+ VLAN的标签字段
  + TPID（标签协议标识符）
  + TCI（标签控制信息）
    + 优先级（Priority）
    + CFI（规范格式指示器）
    + VLAN ID（VLAN标识符）



## 多VLAN环境下交换机工作机制

+ 交换机接收到广播数据帧时，它只会将这个数据帧从除了该数据帧入站端口之外，其他同VLAN的所有端口发送出去
+ 交换机接收到一个目的MAC地址不存在于自己MAC地址表中的单播数据帧时，它只会将这个数据帧从除了该数据帧入站端口之外，其他同VLAN的端口发送出去



## WLAN的工作原理概述

+ 在不借助路由转发的大前提下，交换机不会将从一个VLAN的端口中接收到的数据帧，转发给任何其他VLAN中的端口



## 跨交换机VLAN原理

+ PVID
  + 无标记帧的VLAN ID
  + 是管理员给交换机接口配置的参数
  + 默认值为1



### 交换机接口类型

![image-20220927211531455](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927211531455.png)

+ Acess接口，通常用于连接终端设备
+ Trunk接口，通常用于交换机之间互联



### 交换机Access接口的工作特点

+ 收到数据帧时，为数据帧打上VLAN标签
+ 发送数据帧时，移除VLAN标签



### 交换机Trunk接口的工作特点

+ 收到数据帧时，保留原有数据帧的VLAN标签
+ 发送数据帧时，为了让对端设备能够区分自己发出流量所在的VLAN而携带VLAN标签

- 例外：当交换机需要从Trunk接口发送的数据帧VLAN标签与这个Trunk接口的PVID相同，交换机会以不携带VLAN标签的方式来发送这个数据帧



### 交换机原理补充

+ 收到未知的单播帧，向本VLAN所有的非接收端口泛洪
+ 收到未知的单播帧，也会向所有Trunk接口泛洪



### 实验

![image-20220927215740082](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927215740082.png)

1. `sy`进入系统视图

2. `sysname SW1`将交换机改名为SW1

3. `display vlan`查看vlan状况

   ![image-20220927220036154](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927220036154.png)

4. `vlan 10 vlan 20`创建vlan10和vlan20

   ![image-20220927220147324](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927220147324.png)

5. `interface g0/0/1`进入GE0/0/1接口

6. `port link-type access`设置接口类型为access

7. `port default vlan 10`将接口连接到vlan10

8. 将GE0/0/2按上述操作接入vlan20

9. `display vlan`

   ![image-20220927220716187](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927220716187.png)

10. 设置trunk类型接口

    ```
    interface g0/0/10
    port link-type trunk
    port trunk allow-pass vlan 10 20 运行vlan10 20通过
    ```

11. `di this`查看接口和接口类型

    ![image-20220927221319283](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220927221319283.png)

12. 将其他设备进行相同的配置





# 冗余性和STP

冗余性可以增加网络的可用性，但可能形成一个封闭的信息环路给通信带来毁灭性的影响。

## 冗余链路

+ 冗余设备和链路解决网络的单点故障

  ![image-20220928102922708](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928102922708.png)



## 冗余给网络带来的隐患

+ 重复帧

+ MAC地址震荡

  ![image-20220928103405366](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928103405366.png)

+ 广播风暴

  ![image-20220928103508181](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928103508181.png)

  

## STP

### 作用：在冗余链路的网络环境下

+ 去除单点故障的同时保证每个节点可达
+ 打破网络中的逻辑环路，阻断广播帧的循环广播



### 由来

![image-20220928104132385](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928104132385.png)



### 工作原理

+ 根据一些规则判断出哪些端口能够转发数据，哪些端口不能转发数据
+ 不能转发数据的端口将它禁用起来
+ 实时监控各个端口和链路的状态。当出现故障时，STP会启用一些被禁用的端口



### 工作流程

1. 选取根网桥
   - 每个STP网络中都有且只有一台根网桥（亦称根交换机）
   - 作为根网桥的这台交换机就是STO所构建的生成树的根
   - 选举范围为整个交换网络
2. 选举根端口
   - 非交换机会在自己的所有端口之间，选择出距离根网桥最近的端口
   - 选举范围为每个交换机（除根交换局）
3. 选举指定端口
   - 位于同一网段中的所有端口之间选择出一个距离根网桥最近的端口 
   - 选举范围为每个网段
4. 阻塞预备端口
   + 在选出了根端口和指定端口后，STP会把那些既不是根端口，也不是指定端口的其他所有端口置于阻塞状态



#### 1.根网桥的选举

+ 参选者：在一个STP网络中，默认所有交换机都会参与根网桥的选举
+ 选举原则：在选取根网桥时，交换机之间相互对比的参数是”桥ID“

![image-20220928110730183](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928110730183.png)

![image-20220928110818313](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928110818313.png)



##### 桥ID的定义

- 优先级：16bit字段，默认为32768
- MAC地址：48bit字段，交换机的硬件MAC地址
- 由优先级和MAC地址组成一个64bit的字段



##### 根网桥的选举规则

- 首先，比较优先级，优先级小者优先
-  其次，比MAC地址，MAC地址小者优先



### 2.根端口（RP）的选举

+ 选举的范围是每台非根交换机
+ 参选者的是这台非根交换机上所有启用的端口



#### 选举原则

1. 选择根路径开销（Root Path Cost，RPC）最低的端口

   ![image-20220928112531734](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928112531734.png)

2. 若有多个端口RPC相等，选择对端桥ID最低的端口（BID）

   ![image-20220928112812535](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928112812535.png)

3. 若有多个端口的对端桥ID相等，选择对端端口ID最低的端口（PID=端口号+优先级128）

   ![image-20220928112944317](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928112944317.png)



### 3.指定端口（DP）的选举

+ 选举的范围是每个网段
+ 参选者是同处于这个网段中的所有端口（不包括已经被选举为根端口的端口）



#### 选举原则

1. 选择根路径开销（Root Path Cost，RPC）最低的端口

2. 若有多个端口的RPC相等，选择桥ID最低的端口（本端）

3. 若有多个端口桥ID相等，选择端口ID最低的端口（本端）

![image-20220928113850127](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928113850127.png)



### 4.阻塞剩余端口



### 交换机端口角色归纳

+ 根端口：非根桥上距离根桥最近的端口，处于转发状态
+ 指定端口：每一个网段中距离根最近的端口，处于转发状态
+ 预备端口：落选的端口，处于监听状态



![image-20220928114305332](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928114305332.png)

预备端口接收BPDU，检测其他线路是否存在问题。



# RSTP

+ STP的收敛速度特点
  + 端口从阻塞状态过渡到转发状态，转发延迟就会消耗30秒
  + 发送故障时，处于阻塞状态的端口无法收到BPDU，它默认会等待20秒，也就是等待MaxAge计算器超时，才会触发交换机重新计算STP

![image-20220928115048201](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928115048201.png)

+ RSTP特点
  + 取消和修改了STP标准中定义的某些端口状态
  + 定义了几个新的端口角色和一些可以让端口直接由阻塞状态过渡到转发状态的情形
  + 减少了交换机等待根交换机发送CBPDU的时间（6s）

### 端口角色

+ 根端口（RP）
+ 指定端口（DP）
+ 预备端口（AP）
+ 备份端口（Backup Port，BP）



#### 预备端口与备份端口比较

+ 预备端口（AP）和备份端口（BP）在拓扑完成收敛后都会被RSTP阻塞
+ 端口接收到更优BPDU是由其他网桥转发过来的，代表这个端口为预备端口
+ 端口接收到的更优BPDU是本网桥发送到，代表这个端口为备份端口

![image-20220928120853607](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928120853607.png)



### 边缘端口

![image-20220928121332177](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928121332177.png)



## PSTP中的P/A机制

+ 工作于非边缘的点到点的端口类型
+ 选择让指定端口于链路对端进行握手，并逐级传递的方式来避免环路
+ 完成握手的RSTP指定端口即可直接过渡到转发状态，而不需要经历任何涉及计算器的过渡状态







# 路由基础

## 路由概述

+ 路由（routing）指的是中间设备（比如路由器）通过查找路由表对数据包进行转发的处理方式
+ 在一个典型的数据通信网络中，往往存在多个不同的IP网段，数据在不同的IP网段之间交互是需要借助三层设备的，这些设备具备路由能力，能够实现数据的跨网段转发
+ 路由是数据通信网络中最基本的要素。路由信息是指导报文转发的路径信息，路由过程就是报文转发的过程

+ 路由是指导报文转发路径信息，通过路由可以确定转发IP报文的路径
+ 路由设备是依据路由转发报文到目的网段的网络设备，最常见的路由设备：路由器
+ 路由设备维护者一张路由表，保存着路由信息



## 路由信息介绍

![image-20221012155230866](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012155230866.png)

+ 路由包含以下信息
  + 目的网络：标识目的网络
  + 掩码：与目的地址共同标识一个网段
  + 出接口：数据包被路由后离开本路由器的接口
  + 下一跳：路由转发到目的网段的数据包所使用的下一跳



### 路由表

![image-20221012155617958](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012155617958.png)

+ 路由器通过各种方式发现路由
+ 路由器选择最优的路由条目放入路由表中
+ 路由表指导设备对IP报文的转发
+ 路由器通过对路由表的管理实现对路径信息的管理



### 背景：网段之间通信

+ IP地址唯一标识了网络中的一个节点，每个IP地址都拥有自己的网段，各个网段可能发布在网络的不同区域
+ 为实现IP寻址，发布在不同区域的网段之间都要能够相互通信



## MAC地址与IP地址对比

+ 都可以用来定位设备
+ MAC地址工作与数据链路层，而IP地址工作于网络层
+ MAC地址是物理地址，而IP地址是逻辑地址
+ MAC地址随载体移动，而IP地址不随载体移动



## 网络设备建立转发数据库的方式

+ 把自己各个接口所在的子网记录进转发数据库
+ 直接向设备的转发数据库中输入向某些子网转发数据的路径
+ 相互学习彼此转发数据库中的数据转发路径



## 路由相关概念

+ 路由表（Routing Table）等价于转发数据库
+ 路由表中”路由条目“等价于转发数据的路径



## 路由器的转发数据工作原理

+ 路由表是路由器赖以转发数据包的数据库
+ 用数据包的目的IP地址去匹配路由表中的路由条目
+ 根据匹配条目的路由参数决定任何转发这个数据库



## 路由表的查看命令

+ 查看IPv4路由表的摘要信息

  ```
  [Router]display ip routing-table
  ```

+ 在命令尾部加上参数verbose可查看路由表的详细信息

  ```
  [Router]display ip routing-table verbose
  ```

  

## 路由信息的三种来源

+ 直连路由：只要来连接该网络的接口状态正常，无需多做配置，直连路由就会出现在路由表中
+ 静态路由：需要管理员通过命令手动添加到路由表中
+ 动态路由：通过路由协议从邻居路由器哪里学习过来的路由



## 路由优先级

+ 路由器给每种路由信息渠道赋予的一个权重，此权重值就叫路由优先级（亦称协议优先级）
+ 路由优先级值越小，代表这种话类型的路由可信度越高
+ 当路由器从多种不同的途径获知到达同一个目的网段的路由（这些路由的目的网络地址及网络掩码均相同）时，路由器会比较这些路由的优先级，优选优先级值最小的路由
+ 拥有最高优先级的路由将被添加进路由表

![image-20221012161509703](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012161509703.png)

![image-20220928150331920](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928150331920.png)



## 路由度量值

+ 指去往目的网络的开销
+ 度量值越小越优先
+ 不同的路由协议参考计算度量值的因素不一样



## 路由信息获取方式

+ 路由器依据路由表进行路由转发，为实现路由转发，路由器需要发现路由，以下为常见的路由获取方式

![image-20221012160016963](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012160016963.png)



## 查看IP路由表

![image-20221012160810808](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012160810808.png)

![image-20221012160822208](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012160822208.png)



## 1.直连路由

+ 路由会把状态正常的接口所连接的网络，作为直连路由放入自己的路由表中

+ 直连路由的路由优先级和度量值皆为0

+ 直连路由的路由优先级和度量值都是不可修改的

+ 直连路由指向本地直连网络的路由，由设备自动生成

+ 当路由器为路由转发的最后一条路由器时，IP报文匹配直连路由，路由器转发IP报文到目的主机

+ 使用直连路由进行路由转发时，报文的目的IP和路由器接口IP在一个网段中

  ![image-20221012160543677](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012160543677.png)

+ 并不是所有接口生成的直连路由都会出现在路由表中，直连路由出现在路由表中的前提是该接口的物理状态、协议状态都为UP

  ![image-20221012160659730](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221012160659730.png)

  

### 实例

![image-20220928151447527](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151447527.png)

+ AR1通过命令display ip interface brief查看接口状态

  ![image-20220928151536457](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151536457.png)

  ![image-20220928151648757](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151648757.png)

  ![image-20220928151704906](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151704906.png)

+ ![image-20220928151809254](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151809254.png)

+ ![image-20220928151826155](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928151826155.png)

  



## 2.静态路由

- 手工配置去往目的网络的路径
- 默认值：有优先级（60）、度量值（0）
- 优先级可以通过命令修改



### 静态路由优先级的调配

+ 去往同一目的网络，优先级相同可以实现负载

  ![image-20220928193133736](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928193133736.png)

- 去往同一网络，配置优先级不同则可以实现主备

  ![image-20220928193457171](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928193457171.png)



#### 优点

+ 静态路由比动态路由更加稳定
+ 静态路由比动态路由更加可控
+ 静态路由比动态路由更加容易部署



#### 缺点

+ 静态路由的扩展性很差
+ 静态路由无法反映拓扑的变化



#### 静态路由配置

![image-20220928194338139](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928194338139.png)

![image-20220928194552938](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220928194552938.png)



####  实验

![image-20220929110607992](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220929110607992.png)

AR4

![image-20220929110815908](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220929110815908.png)

AR3，AR2

![image-20220929111043545](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220929111043545.png)



#### 配置方法

![image-20220929111444511](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20220929111444511.png)

+ Trunk口（点到点线路上）可以用以上所有的配置方法
+ GE口
  + 指向下一跳
  + 指向出接口和下一跳





### 默认路由

+ 默认路由实际上是一种特殊的静态路由



#### 概述

+ 最长匹配原则（选路由）
  + 当多条路由均匹配数据包的目的IP地址时，路由器会按照掩码最长的，也就是最精确的那条路由来转发这个数据包
  + 一条全0路由可以匹配以任何IP地址作为目的地址的数据包



+ 默认路由
  + 掩码长度全为0的静态路由称为默认路由
  + 通常用于目标网络地址不明的路由配置



#### 应用场景

![image-20221004174819630](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004174819630.png)



#### 配置方法

![image-20221004174839361](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004174839361.png)







# 三层交换技术

如果一台交换机可以集成三层路由的功能，那么它在同一个VLAN中的主机提供基于MAC地址的数据帧转发，还可以在内部消化掉整个VLAN间路由所需的三层数据包转发



## 概述

### 二层交换机的特征

+ 旨在连接同构网络的设备
+ 第一个来自于某个源MAC地址的数据帧，会改变交换机此后的转发行为
+ 根据目的MAC是否匹配MAC地址表以及该条目是否是数据帧的入站接口作出转发、泛洪和丢弃的决策
+ 交换操作（switching）是一项高度程式化的固定流程



### 路由器特征

+ 旨在连接异构网络的设备
+ 必须在各层支持大量不同的协议和标准
+ 路由器相互学习路由和根据最长匹配原则来判断数据包出站接口的过程远比交接机执行交换操作的逻辑要复杂得多



### 三层交换机

+ 集成了三层数据包转发功能的交换机被称为三层交换机
+ 可以实现将终端隔离在不同VLAN中，同时为这些终端提供VLAN间路的功能
+ 随着通过ASIC（和网络处理器）开始大量应用于路由器，路由器和交换机中间的界限已经变得十分模糊



#### 三层交换机配置

1. 创建VLAN并且根据设计方案将各个接口划分到不同的VLAN的配置与二层交换机一致

2. 路由部分的配置方法和命令根路由器的配置相差无几

3. 三层交换机需要解决接口分配三层IP地址的配置，否则不具备称为终端网关设备的能力

   

#### 虚拟VLAN接口

- 简称SVI接口
- 它们所在的网段作为直连路由填充在路由表中
- 虚拟VLAN接口就十分适合充当该VLAN所连接设备的网关

![image-20221004191945757](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004191945757.png)

![image-20221004192023816](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004192023816.png)

![image-20221004192148996](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004192148996.png)

![image-20221004192204478](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221004192204478.png)



#### 、





# 动态路由

## 静态路由和动态路由协议对比

+ 相对于静态路由，动态路由协议更适合于大规模网络环境中的理由
  + 动态路由协议的扩展性强
    + 就配置而言，随着网络规模的增加，配置静态路由的难度也会随之加大
    + 而配置动态路由，则只需要宣告路由器的直连网段，相对简化得多
    
  + 动态路由协议具备应变能力
  
    + 静态路由缺乏应变能力导致静态路由不太适合在大型网络中单独使用
    + 而动态路由则可以对网络产生异常而自动收敛和应变
  
     
  
  

## 路由协议的分类（算法角度）

+ 根据路由协议所使用的算法对路由协议进行分类

  + 距离矢量型路由协议——DV
    + 采用贝尔曼——福特算法
    + 通过DV路由协议学习到的远端网络，D和V就是路由器所了解的全部信息
  + 链路状态型路由协议——LS
    + 使用Di jkstra算法，计算出去往各个网络的最优路径
    + 路由器通过LS路由协议通告的链路状态信息中包括了全部关于这个网络的具体信息

  + 两类路由协议比较

    + 运行距离矢量型路由协议的路由器只拥有自己周围这几台路由器分享的距离和矢量信息

    + 运行链路状态型路由协议的路由器则像是在每个路口为远足者提供一张完整的区域地图



## 路由协议的分类（掩码角度）

+ 从路由协议在发送路由更新信息是是否会携带掩码，将路由协议分为
  + 有类路由协议
  + 无类路由协议（使用较多）



### 有类路由协议

![image-20221008145224370](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008145224370.png)

![image-20221008145425557](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008145425557.png)



## 距离矢量型路由协议

### 特点

+ 易配置
+ 具备动态路由协议的扩展性和应变能力
+ 能够自动学习路由、选择路由
+ 避免网络中出现环路
+ 路由通告方式是周期更新



### 路由学习

+ 初始状态

  ![image-20221008145924593](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008145924593.png)

  在还没有运行距离矢量之前，路由表中只有直连路由

+ 配置距离矢量型路由协议路由相互通告稳定后

  ![image-20221008150706526](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008150706526.png)

  所有路由器路由表示是一致的，这个一致指的是子网一致，而不是度量、下一跳一致



### 环路隐患

+ 网络中出现了接口状态变化

  ![image-20221008151728226](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008151728226.png)

+ 12.1.2.0/24线路出现问题，AR1路由表中删除这个线路，但其他路由不知道这条线路出现问题，依旧往这个线路发送信息，导致AR1学习到了错误的路由

  ![image-20221008151958424](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008151958424.png)

+ 路由环路出现

  ![image-20221008152137077](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008152137077.png)





### RIP的环路避免机制

#### 水平分割

+ 水平分割（Split Horizon）引入的规制是，禁止路由器将从一个接口学习到的路由，再从同一个接口通告出去

  ![image-20221008153143735](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008153143735.png)

  AR1从E0接口将路由信息通告给AR2，但是AR2不能将从AR1学习到的路由信息从E0再通告给AR1

  ![image-20221008153513269](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008153513269.png)



#### 毒性防范转

+ 毒性反转的做法是，当路由器从一个接口学习到一条去往某个网络路由时，它就会通过这个接口通告一条该网络不可达的路由

  当你从一个接口收到一条路由，这台路由器依旧会把路由从接口回传出去，但是会把这个路由设置为不可达

![image-20221008154319419](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008154319419.png)

![image-20221008154337842](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008154337842.png)



毒性反转和水平分割互斥



#### 路由毒化与触发更新

+ 路由毒化（Route Poisoning）是指路由器会将自己路由表中已经失效的路由作为一条不可达路由主动通告出去
+ 触发更新（Triggered Update)顾名思义，是指路由器在网络发送变化是，不等待更新计数器到时，就主动发送更新

![image-20221008154910894](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008154910894.png)





## 链路状态型路由协议

### 链路状态协议信息交互

+ Hello消息建立和维护邻居关系
+ 建立邻居后，路由器会把自己对于（启用了这个路由协议的）接口链路的了解，发送给自己所有的邻居
+ 链路状态信息中包含了各个直连链路的网络/掩码、网络类型、开销值及邻居设备、序列号和过期信息



1. 通告链路状态信息

![image-20221008160046044](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008160046044.png)



2. AR2接收到链路状态通告消息之后的处理方式

   ![image-20221008160245022](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008160245022.png)

3. 各个路由器通过LSDB计算出来的拓扑图

   ![image-20221008160421564](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008160421564.png)









# OSPF报文类型

## 类型字段取值为1：Hello消息

### Hello消息的作用

+ OSPF依靠Hello消息建立OSPF邻居关系



### Hello消息中包含的信息

| 链路层头部 | IP头部 | OSPF头部 | OSPF数据部分 | 链路层尾部 |
| ---------- | ------ | -------- | ------------ | ---------- |

![image-20221008161617573](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008161617573.png)

![image-20221008161631569](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008161631569.png)

 ![image-20221008161903298](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008161903298.png)



### OSPF建立邻居关系的必要条件

+ 接口掩码相匹配（以太网）
+ Hello时间间隔一样
+ 路由器失效时间间隔一样
+ 认证类型和认证密钥







## 类型字段取值为2：数据库描述消息 DD

### 数据库描述消息的作用

+ 把自己链路状态数据库中拥有的所有链路状态通告（LSA）列出一个清单，然后交换这个清单

+ OSPF路由器相互交换链路状态信息的方式是使用对方发送的清单进行查漏补缺



### 数据库描述信息中包含的信息

![image-20221008162945331](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008162945331.png)

![image-20221008163006184](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008163006184.png)





## 类型字段取值为3：链路状态请求消息 LSR

### 链路状态请求消息作用

+ 路由器通过其他OSPF路由发送来的数据库描述消息进行查漏补缺之后，他就会发送链路状态请求消息请该设备用其链路状态数据中的LSA为自己补缺



### 链路状态请求消息中包含的信息

![image-20221008163324092](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008163324092.png)

![image-20221008163333411](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008163333411.png)



## 类型字段取值为4：链路状态更新消息 LSU

### 链路状态更新消息的作用

+ 当路由接收到邻居发送过来的链路状态请求消息之后，它就会按照该消息中指定的LSA封装一个链路状态更新消息，将对方所请求的各个LSA副本通过这个链路状态更新消息通告给它

### 链路状态更新消息中包含的信息

![image-20221008163757619](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008163757619.png)





## 类型字段取值为5：链路状态确认消息 LSACK

### 链路状态确认消息的作用

当路由器接收到了对方路由器发送的链路状态更新消息时，它需要对这个更新消息中包含的所有LSA——进行确认，而确认LSA的方式和描述链路状态数据中LSA的方式相同，即使用各个LSA的头部来确认更新消息中包含的LSA



### 链路状态确认消息中包含的信息

![image-20221008164109268](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008164109268.png)



## 总结

![image-20221008164235132](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008164235132.png)



# OSPF路由器ID

## 路由器ID——Router-id

+ 一个多用点分十进制方式表示的32位二进制数
+ 在OSPF网路中唯一的标识这台路由器的身份

+ 路由器ID无抢占性



## 路由器ID的选举

+ 管理员手动静态配置了路由器ID最优
+ 其次是最大逻辑接口IP地址
+ 最后是最大的活动的物理接口IP地址



## DR与BDR

+ 需要选取DR与BDR的网络类型

  ![image-20221008170204036](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008170204036.png)



+ DR与BDR的用途
  + DR路由器接口会与所有邻居建立可以互相共享链路状态信息的完全邻接关系
  + BDR也会与所有的邻居建立可以互相共享链路状态信息的完全邻接关系，对DR起到备份的作用
  + 既非DR，亦非BDR的设备则互相之间虽为邻居，却不会建立完全邻接关系，也不会直接共享链路状态信息



+ DR和BDR的概念

  ![image-20221008170808641](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008170808641.png)

  ![image-20221008170821472](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008170821472.png)



+ DR/BDR是路由器接口的概念

  ![image-20221008170858738](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008170858738.png)



+ 路由器优先级
  + 是一个让管理员对其手动进行修改，来影响DR/BDR选举结果的参数
  + 是一个8位二进制数，因此这个数值的取值范围0~255
  + 数值越高机优先级越高
  + 在默认情况下，华为路由器接口的OSPF优先级为1



+ DR与BDR的选举的特点
  + 身份不抢占
  +  在位不选举
  + 先比优先级
  + 再比路由器ID

![image-20221008171653014](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008171653014.png)





# 多区域OSPF

## OSPF分层结构概述

### OSPF的可靠性

+ 同步数据库后独立计算路由
+ 规避了环路等问题
+ OSPF计算出来的最短路径往往最优

### OSPF的分层结构

+ 将OSPF网络划分为不同的区域

+ 区域的编号是一个32位的二进制数

  ![image-20221008172439678](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008172439678.png)

+ 区域编号可以用点分十进制表示，也可以用十进制表示





## OSPF路由器的类型

### OSPF区域设计拓扑

![image-20221008172620423](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008172620423.png)

### OSPF路由器类型分类

+ 内部路由器（Internal Router）

  + 所有接口都被划分到了同一个OSPF区域中的OSPF路由器
  + 这个区域可以是区域0也可以不是区域0
  + 运行其所属区域的OSPF运算法则，仅生成区域内部的路由表项

  ![image-20221008173123145](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008173123145.png)

  

+ 骨干路由器 （Backbone Router）

  + 至少有一个接口被划分到区域0中的OSPF路由器
  + 这个区域必须是区域0

  ![image-20221008173307425](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008173307425.png)

  

+ 区域边界路由器 （Area Border Router）

  + 有接口被划分到区域0也有接口被划分到其他OSPF区域的路由器
  + 是连接区域0与其他OSPF区域的域间通信的关口

  ![image-20221008173505652](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008173505652.png)

  

+ 自治系统边界路由器 （Autonomous System Boundary Router）

  + 将通过其他方式获得的外部路由器条目注入到OSPF网络中，从而获取OSPF网络之外路由信息的路由器
  + 获取的方式可以是动态路由也可以是静态路由

  ![image-20221008173910870](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008173910870.png)



+ 补充
  + 区域0被称为骨干区域（Backbone Area）
  + 除内部路由器和区域边界路由器是两种互斥的类型外，其他类型并不互斥
  + OSPF区域的边界是在路由器（ABR）上，而不是在链路上
  + OSPF区域设计要求，所有区域都必须与区域0直接相连



## OSPF虚链路

+ 不符合OSPF设计要求的网络设计

  + 非骨干区域没有与骨干区域物理上直接相连

    ![image-20221008174403654](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008174403654.png)

  + 骨干区域本身在物理上不连续

    ![image-20221008174451783](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008174451783.png)



+ OSPF虚链路

  + 一条穿越非骨干区域的逻辑通道

  + 在OSPF区域设计不满足OSPF设计要求是，通过ABR之间建立逻辑连接让OSPF网络能够正常完成路由信息的交互

  + 非骨干区域与骨干区域直接相连而采用OSPF虚链路设计

    ![image-20221008174756922](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008174756922.png)

  + 骨干区域没有与骨干区域相连而采用OSPF虚链路设计

    ![image-20221008174848115](HCIA%20%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF.assets/image-20221008174848115.png)



+ OSPF虚链路的说明
  + 虚链路是网络的补丁类技术
  + 网络中采用了虚链路是这个网络中存在故障或设计缺陷的体现
  + 虚链路会增加网络中的管理流量和设备的处理负担，提高管理员对网络问题进行排错的难度
  + 设计全新的OSPF网络时，这种技术不应该以其他理由被考虑在内，除非将虚链路作为默写链路失效时的备份策略































































































































































































































































